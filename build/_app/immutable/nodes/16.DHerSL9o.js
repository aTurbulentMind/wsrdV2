import{f as X,c as n,s as e,a as x,t as D,$ as Pe,F as ze,r}from"../chunks/disclose-version.D32A8cIq.js";import{p as Ve,m as T,g as t,X as Me,Y as Te,t as w,a as Ze,Z as J,$ as c,s as Z,K as We,_ as b}from"../chunks/runtime.Cmx-9IxZ.js";import{s as W}from"../chunks/render.Dx_fi2se.js";import{i as Q}from"../chunks/if.BqhT6dNd.js";import{e as ve,i as Ne}from"../chunks/each.DoEVNEIz.js";import{h as ke}from"../chunks/svelte-head.DsIx1nbp.js";import{a as Fe,e as De}from"../chunks/forms.D4sUk8hc.js";import{a as Y,r as k}from"../chunks/attributes.MW-2LmP5.js";import{e as ue}from"../chunks/events.CQ8HCPju.js";import{r as $e}from"../chunks/misc.doaeRubg.js";import{c as S}from"../chunks/input.L8SjnS8-.js";import{b as R}from"../chunks/select.oKEsmhZ5.js";import{i as Ke}from"../chunks/lifecycle.DAoeH_GG.js";import{p as Oe}from"../chunks/props.BR7FjymL.js";var Ue=D('<article class="event-flyer svelte-111z0l6"><figure class="svelte-111z0l6"><img alt="Event Flyer" class="svelte-111z0l6"></figure></article>'),Xe=D("<p>No matching flyer found.</p>"),Ye=D('<section class="event-with-image svelte-111z0l6"><article class="event-details svelte-111z0l6"><header><h2> </h2></header> <p> </p> <p> </p> <p> </p></article> <!></section>'),je=D('<figure class="svelte-111z0l6"><figcaption class="svelte-111z0l6"> </figcaption> <img alt="Event Flyer" class="svelte-111z0l6"></figure>'),Be=D('<!> <section class="flyers svelte-111z0l6"><h2>All Flyers</h2> <!></section>',1),Ge=D('<form class="sendableForm svelte-111z0l6" method="post" action="?/submit" enctype="multipart/form-data"><input type="hidden" name="eventHub" value="New"> <label class="input-group" for="event_name">Event Name <input type="text" id="event_name" name="event_name" required aria-label="Event Name"></label> <label class="input-group" for="event_date">Event Date <input type="date" id="event_date" name="event_date" required aria-label="Event Date"></label> <label class="input-group" for="location">Event Location <input type="text" id="location" name="location" required aria-label="Event Location"></label> <label for="status_id">Status <select class="selector svelte-111z0l6" id="status_id" name="status_id" required aria-label="Event Status"><option>1 - Pending</option><option>2 - Confirmed</option><option>3 - In Progress</option><option>4 - Completed</option><option>5 - Cancelled</option></select></label> <label class="input-group" for="description">Event Description <textarea id="description" name="description" required aria-label="Event Description"></textarea></label> <label for="event_image">Event Flyer</label> <input type="file" id="event_image" name="images" multiple aria-label="Event Flyer"> <br> <button class="W-button svelte-111z0l6" type="submit">Submit</button></form>'),Je=D("<option> </option>"),Qe=D('<h3>Event Edit</h3> <form class="sendableForm svelte-111z0l6" method="post" action="?/submit" enctype="multipart/form-data"><input type="hidden" name="eventHub" value="Edit"> <select class="selector svelte-111z0l6" name="event_id"><option>-- select an event --</option><!></select> <label class="input-group" for="event_name">Event Name <input type="text" id="event_name" name="event_name" required aria-label="Event Name"></label> <label class="input-group" for="event_date">Event Date <input type="date" id="event_date" name="event_date" required aria-label="Event Date"></label> <label class="input-group" for="location">Event Location <input type="text" id="location" name="location" required aria-label="Event Location"></label> <label for="status_id">Status</label> <select class="selector svelte-111z0l6" id="status_id" name="status_id" required aria-label="Event Status"><option>1 - Pending</option><option>2 - Confirmed</option><option>3 - In Progress</option><option>4 - Completed</option><option>5 - Cancelled</option></select> <label class="input-group" for="description">Event Description <textarea id="description" name="description" required aria-label="Event Description"></textarea></label> <label class="input-group" for="event_image">Event Flyer</label> <img alt="Event Flyer" class="svelte-111z0l6"> <input type="file" id="event_image" name="images" multiple aria-label="Event Flyer"> <button class="W-button svelte-111z0l6" type="submit">Submit</button></form>',1),Re=D('<header class="head_Line"><h1>Modify Events</h1></header> <select class="selector svelte-111z0l6"><option>-- select an event operation --</option><option>View</option><option>New</option><option>Edit</option></select> <!>',1);function dt(qe,pe){Ve(pe,!1);let ee=Oe(pe,"data"),j=ee(),_e=T(j.session),te=T(j.supabase),K=T(j.existingEvents),P=T(j.images),ce=!1,V=T(""),me=new FormData,ae,a=T({event_name:"",event_date:"",location:"",description:"",status_id:"",images:[]});const de=i=>{const l=i.replace(/[^a-zA-Z0-9-_ ]/g,"");return t(P).find(s=>s.url.split("/").pop().replace(/\.[^/.]+$/,"").toLowerCase()===l.toLowerCase())},ne=i=>{const l=i.replace(/[^a-zA-Z0-9-_ ]/g,""),s=t(P).find(m=>m.url.split("/").pop().replace(/\.[^/.]+$/,"").toLowerCase()===l.toLowerCase());return s?`${s.url}?t=${new Date().getTime()}`:null};async function Ce(i){if(ae=i.target.value,!ae){console.log("Step 2: No event selected, exiting function");return}t(P).length===0&&await fetchEventFlyers();const{data:l,error:s}=await t(te).from("events").select("*").eq("event_id",ae).single();if(s)return;Z(a,{...t(a),event_name:l.event_name,event_date:new Date(l.event_date).toISOString().slice(0,10),location:l.location,description:l.description,status_id:l.status_id.toString()});const m=ne(l.event_name);m?c(a,t(a).event_image=m):c(a,t(a).event_image="")}const Ie=[...t(K)].sort((i,l)=>{const s=ne(i.event_name);return ne(l.event_name)-s});function ge(i){const l=i.target.files;c(a,t(a).images=Array.from(l)),me=new FormData,t(a).images.forEach(s=>{me.append("images",s)})}Me(()=>(t(te),t(_e),t(K),t(P),We(ee())),()=>{(()=>{const i=ee();return Z(te,i.supabase),Z(_e,i.session),Z(K,i.existingEvents),Z(P,i.images),i})()}),Te(),Ke();var fe=Re();ke(i=>{Pe.title="Event edit page"});var re=X(fe);n(re),r(re);var B=e(e(re,!0));w(()=>{t(V),J(()=>{})});var ie=n(B);ie.value=((ie.__value="")==null,"");var le=e(ie);le.value=(le.__value="View")==null?"":"View";var oe=e(le);oe.value=(oe.__value="New")==null?"":"New";var be=e(oe);be.value=(be.__value="Edit")==null?"":"Edit",r(B);var Se=e(e(B,!0));Q(Se,()=>t(V)==="View",i=>{var l=Be(),s=X(l);ve(s,1,()=>Ie,Ne,(h,o,L)=>{var p=Ye(),d=n(p),_=n(d),g=n(_),H=n(g);r(g),r(_);var E=e(e(_,!0)),$=n(E);r(E);var y=e(e(E,!0)),q=n(y);w(()=>W(q,b(o).event_date.split("T")[0])),r(y);var F=e(e(y,!0)),C=n(F);r(F),r(d);var M=e(e(d,!0));Q(M,()=>de(b(o).event_name),N=>{var f=Ue(),I=n(f),A=n(I);w(()=>Y(A,"src",`${de(b(o).event_name).url}?t=${new Date().getTime()}`)),r(I),r(f),x(N,f)},N=>{var f=Xe();x(N,f)}),r(p),w(()=>{W(H,b(o).event_name),W($,b(o).description),W(C,b(o).location)}),x(h,p)});var m=e(e(s,!0)),z=n(m),O=e(e(z,!0));ve(O,7,()=>t(P),(h,o)=>h.id,(h,o,L)=>{var p=je(),d=n(p),_=n(d);w(()=>W(_,b(o).url.split("/").pop().replace(/\.[^/.]+$/,""))),r(d);var g=e(e(d,!0));r(p),w(()=>Y(g,"src",b(o).url)),x(h,p)}),r(m),x(i,l)},i=>{var l=ze(),s=X(l);Q(s,()=>t(V)==="New",m=>{var z=Ge(),O=n(z),h=e(e(O,!0)),o=e(n(h));k(o),r(h);var L=e(e(h,!0)),p=e(n(L));k(p),r(L);var d=e(e(L,!0)),_=e(n(d));k(_),r(d);var g=e(e(d,!0)),H=e(n(g));w(()=>{t(a).status_id,J(()=>{})});var E=n(H);E.value=(E.__value="1")==null?"":"1";var $=e(E);$.value=($.__value="2")==null?"":"2";var y=e($);y.value=(y.__value="3")==null?"":"3";var q=e(y);q.value=(q.__value="4")==null?"":"4";var F=e(q);F.value=(F.__value="5")==null?"":"5",r(H),r(g);var C=e(e(g,!0)),M=e(n(C));$e(M),r(C);var N=e(e(C,!0)),f=e(e(N,!0)),I=e(e(f,!0)),A=e(e(I,!0));Y(A,"aria-busy",ce),r(z),Fe(z,v=>De(v)),S(o,()=>t(a).event_name,v=>c(a,t(a).event_name=v)),S(p,()=>t(a).event_date,v=>c(a,t(a).event_date=v)),S(_,()=>t(a).location,v=>c(a,t(a).location=v)),R(H,()=>t(a).status_id,v=>c(a,t(a).status_id=v)),S(M,()=>t(a).description,v=>c(a,t(a).description=v)),ue("change",f,ge,!1),x(m,z)},m=>{var z=ze(),O=X(z);Q(O,()=>t(V)==="Edit",h=>{var o=Qe(),L=X(o),p=e(e(L,!0)),d=n(p),_=e(e(d,!0));w(()=>{t(a).id,J(()=>{t(K)})});var g=n(_);g.value=((g.__value="")==null,"");var H=e(g);ve(H,1,()=>t(K),Ne,(u,G,et)=>{var U=Je(),we={},Ae=n(U);r(U),w(()=>{we!==(we=b(G).event_id)&&(U.value=(U.__value=b(G).event_id)==null?"":b(G).event_id),W(Ae,b(G).event_name)}),x(u,U)}),r(_);var E=e(e(_,!0)),$=e(n(E));k($),r(E);var y=e(e(E,!0)),q=e(n(y));k(q),r(y);var F=e(e(y,!0)),C=e(n(F));k(C),r(F);var M=e(e(F,!0)),N=e(e(M,!0));w(()=>{t(a).status_id,J(()=>{})});var f=n(N);f.value=(f.__value="1")==null?"":"1";var I=e(f);I.value=(I.__value="2")==null?"":"2";var A=e(I);A.value=(A.__value="3")==null?"":"3";var v=e(A);v.value=(v.__value="4")==null?"":"4";var he=e(v);he.value=(he.__value="5")==null?"":"5",r(N);var se=e(e(N,!0)),Ee=e(n(se));$e(Ee),r(se);var Le=e(e(se,!0)),ye=e(e(Le,!0)),xe=e(e(ye,!0)),He=e(e(xe,!0));Y(He,"aria-busy",ce),r(p),w(()=>Y(ye,"src",t(a).event_image)),Fe(p,u=>De(u)),R(_,()=>t(a).id,u=>c(a,t(a).id=u)),ue("change",_,Ce,!1),S($,()=>t(a).event_name,u=>c(a,t(a).event_name=u)),S(q,()=>t(a).event_date,u=>c(a,t(a).event_date=u)),S(C,()=>t(a).location,u=>c(a,t(a).location=u)),R(N,()=>t(a).status_id,u=>c(a,t(a).status_id=u)),S(Ee,()=>t(a).description,u=>c(a,t(a).description=u)),ue("change",xe,ge,!1),x(h,o)},null,!0),x(m,z)},!0),x(i,l)}),R(B,()=>t(V),i=>Z(V,i)),x(qe,fe),Ze()}export{dt as component};
