import{c as w,s as o,a as f,t as h,r as U}from"./disclose-version.D32A8cIq.js";import{p as D,X as I,Y as K,t as v,a as M,g as r,m as E,K as N,s as u}from"./runtime.Cmx-9IxZ.js";import{s as O}from"./render.Dx_fi2se.js";import{i as k}from"./if.BqhT6dNd.js";import{a as d,r as T,s as X}from"./attributes.MW-2LmP5.js";import{e as q}from"./events.CQ8HCPju.js";import{b as C}from"./input.L8SjnS8-.js";import{i as F}from"./lifecycle.DAoeH_GG.js";import{p as g}from"./props.BR7FjymL.js";import{c as G}from"./index-client.CYjeMyXv.js";var H=h('<img class="avatar image">'),J=h('<div class="avatar no-image"></div>'),Q=h('<div class="uppyPoto svelte-ixhsmn"><label class="button primary block" for="single"> </label> <input style="visibility: hidden; position:absolute;" type="file" id="single" accept="image/*"></div>'),S=h('<div><!> <input type="hidden" name="avatarUrl"> <!></div>');function ia(z,i){D(i,!1);let l=g(i,"size",0,10),n=g(i,"url",4),x=g(i,"supabase"),p=E(null),c=E(!1),m=E();const B=G(),L=async t=>{try{const{data:a,error:e}=await x().storage.from("avatars").download(t);if(e)throw e;const s=URL.createObjectURL(a);u(p,s)}catch(a){a instanceof Error&&console.log("Error downloading image: ",a.message)}},P=async()=>{try{if(u(c,!0),!r(m)||r(m).length===0)throw new Error("You must select an image to upload.");const t=r(m)[0],a=t.name.split(".").pop(),e=`${Math.random()}.${a}`,{error:s}=await x().storage.from("avatars").upload(e,t);if(s)throw s;n(e),setTimeout(()=>{B("upload")},100)}catch(t){t instanceof Error&&alert(t.message)}finally{u(c,!1)}};let R=g(i,"showUploadButton",0,!0);I(()=>N(n()),()=>{n()&&L(n())}),K(),F();var _=S(),A=w(_);k(A,()=>r(p),t=>{var a=H();v(()=>{d(a,"src",r(p)),d(a,"alt",r(p)?"Avatar":"No image"),d(a,"style",`height: ${l()??""}em; width: ${l()??""}em;`)}),f(t,a)},t=>{var a=J();v(()=>d(a,"style",`height: ${l()??""}em; width: ${l()??""}em;`)),f(t,a)});var b=o(o(A,!0));T(b);var Y=o(o(b,!0));k(Y,R,t=>{var a=Q(),e=w(a),s=w(e);U(e);var y=o(o(e,!0));U(a),v(()=>{d(a,"style",`width: ${l()??""}em;`),O(s,r(c)?"Uploading ...":"Upload"),y.disabled=r(c)}),C(y,()=>r(m),j=>u(m,j)),q("change",y,P,!1),f(t,a)}),U(_),v(()=>X(b,n())),f(z,_),M()}export{ia as A};
